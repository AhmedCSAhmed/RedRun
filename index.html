<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>root@redrun:~/SYSTEM</title>
    
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #050000;
            --term-red: #ff3333;
            --term-dim: #770000;
            --term-white: #ffcccc; /* White-hot red */
            --glow: 0 0 4px rgba(255, 50, 50, 0.5);
            --scanline: rgba(0, 0, 0, 0.5);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--term-red);
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            line-height: 1.4;
            height: 100vh;
            overflow: hidden; /* We handle scrolling inside .terminal-screen */
            text-shadow: var(--glow);
        }

        /* --- CRT OVERLAYS --- */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.3));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 100;
            opacity: 0.6;
        }

        .crt-flicker {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 99;
            background: rgba(255, 0, 0, 0.02);
            opacity: 0;
            animation: flicker 0.1s infinite;
        }

        @keyframes flicker {
            0% { opacity: 0.02; } 50% { opacity: 0.05; } 100% { opacity: 0.02; }
        }

        /* --- TERMINAL CONTAINER --- */
        .terminal-screen {
            width: 100%;
            height: 100%;
            padding: 20px;
            overflow-y: auto;
            scroll-behavior: auto; /* Instant scroll for terminal feel */
            display: flex;
            flex-direction: column;
            padding-bottom: 60px; /* Space for fixed input */
        }

        /* Custom Scrollbar (Hidden but functional) */
        .terminal-screen::-webkit-scrollbar { width: 8px; }
        .terminal-screen::-webkit-scrollbar-track { background: #000; }
        .terminal-screen::-webkit-scrollbar-thumb { background: var(--term-dim); }

        /* --- TYPOGRAPHY & ELEMENTS --- */
        a { color: inherit; text-decoration: none; cursor: pointer; }
        a:hover { background: var(--term-red); color: #000; text-shadow: none; }

        .cmd-line { margin-top: 10px; margin-bottom: 5px; display: flex; }
        .prompt { color: var(--term-red); font-weight: bold; margin-right: 10px; white-space: nowrap; }
        .command-text { color: var(--term-white); font-weight: bold; }
        
        .output { margin-bottom: 15px; white-space: pre-wrap; color: var(--term-red); }
        .output-text { opacity: 0.9; }

        /* File Listing Styles */
        .file-row { display: flex; gap: 15px; }
        .file-perm { color: var(--term-dim); }
        .file-name { color: var(--term-white); cursor: pointer; font-weight: bold; text-decoration: underline; text-decoration-color: var(--term-dim);}
        .file-name:hover { background: var(--term-red); color: #000; text-decoration: none; }

        /* Highlights */
        .hl { color: var(--term-white); font-weight: bold; }
        .error { color: #ff0000; font-weight: bold; background: rgba(255,0,0,0.1); }
        
        /* --- INPUT BAR (Fixed at bottom) --- */
        .input-bar {
            position: fixed;
            bottom: 0; left: 0; width: 100%;
            background: var(--bg-color);
            padding: 10px 20px;
            border-top: 1px solid var(--term-dim);
            display: flex;
            align-items: center;
            z-index: 50;
        }

        .cursor {
            display: inline-block;
            width: 10px; height: 18px;
            background: var(--term-red);
            animation: blink 1s step-end infinite;
            margin-left: 5px;
        }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* Mobile Adjustments */
        @media (max-width: 600px) {
            .terminal-screen { padding: 10px; font-size: 12px; }
            .file-row { flex-wrap: wrap; gap: 5px; }
        }
    </style>
</head>
<body>

    <div class="scanlines"></div>
    <div class="crt-flicker"></div>

    <div class="terminal-screen" id="console">
        </div>

    <div class="input-bar">
        <span class="prompt">root@redrun:~$</span>
        <span id="active-input" class="command-text"></span>
        <span class="cursor"></span>
    </div>

    <script>
        // --- DATA ---
        const FILE_SYSTEM = [
            { name: 'README.md', type: 'file', content: 'readme' },
            { name: 'INSTALL.txt', type: 'file', content: 'install' },
            { name: 'USAGE.man', type: 'file', content: 'usage' },
            { name: 'logs/', type: 'dir', content: null },
            { name: 'test_fail.log', type: 'log', content: 'test' },
            { name: 'dep_error.log', type: 'log', content: 'dep' },
            { name: 'infra_to.log', type: 'log', content: 'infra' },
            { name: 'build_err.log', type: 'log', content: 'build' },
            { name: 'db_conn.log', type: 'log', content: 'db' }
        ];

        const ASCII_LOGO = `
  ██████████████████████████████████████████████████████████████████████
  █                                                                    █
  █                            REDRUN v1.0                             █
  █                 Deterministic CI Failure Analysis                  █
  █                                                                    █
  ██████████████████████████████████████████████████████████████████████
`;

        const CONTENTS = {
            readme: `
NAME
    RedRun - Deterministic CI Failure Analysis Tool

DESCRIPTION
    RedRun is a CLI tool that parses raw build logs from failed CI runs 
    and extracts high-signal error information.

DESIGN PHILOSOPHY
    1. Deterministic: No ML hallucinations.
    2. Fast: Runs in milliseconds.
    3. Hackable: Pure Python, easy regex rules.
            `,
            install: `
To install RedRun, copy the following:

$ pip install git+https://github.com/AhmedCSAhmed/RedRun.git

Dependencies: Python 3.8+
            `,
            usage: `
USAGE: redrun analyze [FILE]

Examples:
  $ redrun analyze build.log
  $ cat build.log | redrun analyze
            `,
            // LOGS
            test: `
<span class="hl">Analyzing test_fail.log...</span>
----------------------------------------
FAILURE CATEGORY: <span class="hl">TEST FAILURE</span>
CONFIDENCE: 99%

[ERROR EXTRACT]
Line 245: AssertionError: Expected status 200, got 401
Line 246: test_auth.py:56 in test_login_flow
            `,
            dep: `
<span class="hl">Analyzing dep_error.log...</span>
----------------------------------------
FAILURE CATEGORY: <span class="hl">DEPENDENCY ERROR</span>

[ERROR EXTRACT]
Line 102: ERROR: Could not find a version that satisfies requirement django==4.2
Line 103: ERROR: No matching distribution found for django==4.2
            `,
            infra: `
<span class="hl">Analyzing infra_to.log...</span>
----------------------------------------
FAILURE CATEGORY: <span class="hl">INFRASTRUCTURE TIMEOUT</span>

[ERROR EXTRACT]
Line 5001: FATAL: Job execution timeout exceeded: 3600 seconds.
Line 5002: Build wrapper process terminated.
            `,
            build: `
<span class="hl">Analyzing build_err.log...</span>
----------------------------------------
FAILURE CATEGORY: <span class="hl">BUILD ERROR</span>

[ERROR EXTRACT]
Line 45: SyntaxError: invalid syntax (main.py, line 12)
            `,
            db: `
<span class="hl">Analyzing db_conn.log...</span>
----------------------------------------
FAILURE CATEGORY: <span class="hl">DATABASE ERROR</span>

[ERROR EXTRACT]
Line 88: Connection refused: could not connect to postgres:5432
            `
        };

        const consoleDiv = document.getElementById('console');
        const activeInput = document.getElementById('active-input');

        // --- UTILITIES ---

        function createLine(html) {
            const div = document.createElement('div');
            div.className = 'output-text';
            div.innerHTML = html;
            return div;
        }

        function createPrompt(cmd) {
            const div = document.createElement('div');
            div.className = 'cmd-line';
            div.innerHTML = `<span class="prompt">root@redrun:~$</span><span class="command-text">${cmd}</span>`;
            return div;
        }

        function scrollToBottom() {
            window.scrollTo(0, document.body.scrollHeight);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        // --- COMMANDS ---

        function runLS() {
            consoleDiv.appendChild(createPrompt('ls -la --color=auto'));
            
            let output = document.createElement('div');
            output.className = 'output';
            
            // Header
            output.innerHTML += `<div class="file-row"><span class="file-perm">drwxr-xr-x</span> <span>.</span></div>`;
            output.innerHTML += `<div class="file-row"><span class="file-perm">drwxr-xr-x</span> <span>..</span></div>`;

            // Files
            FILE_SYSTEM.forEach(f => {
                let colorClass = f.type === 'dir' ? 'hl' : 'file-name';
                let action = f.type === 'dir' ? '' : `onclick="typeCommand('cat ${f.name}', '${f.content}')"`;
                let display = f.type === 'dir' ? f.name : f.name;
                
                output.innerHTML += `
                    <div class="file-row">
                        <span class="file-perm">-rw-r--r--</span>
                        <span class="${colorClass}" ${action}>${display}</span>
                    </div>`;
            });

            consoleDiv.appendChild(output);
            scrollToBottom();
        }

        function printBootSequence() {
            const lines = [
                "Initializing RedRun Kernel...",
                "Loading memory... 64MB OK",
                "Mounting virtual filesystem...",
                "Access granted: root",
                "Welcome to RedRun Terminal v1.0"
            ];

            let delay = 0;
            lines.forEach((line, index) => {
                setTimeout(() => {
                    consoleDiv.appendChild(createLine(line));
                    scrollToBottom();
                }, delay);
                delay += 150;
            });

            setTimeout(() => {
                consoleDiv.appendChild(createLine(ASCII_LOGO));
                consoleDiv.appendChild(createLine("<br>Click on a file below to inspect contents.<br><br>"));
                runLS();
            }, delay + 500);
        }

        // --- INTERACTION ---

        window.typeCommand = function(cmd, contentKey) {
            // 1. Show text typing in bottom bar
            let i = 0;
            activeInput.innerText = "";
            
            const typing = setInterval(() => {
                activeInput.innerText += cmd[i];
                i++;
                if (i >= cmd.length) {
                    clearInterval(typing);
                    setTimeout(() => {
                        execute(cmd, contentKey);
                    }, 300);
                }
            }, 30);
        };

        function execute(cmd, contentKey) {
            // Move input from bottom bar to main history
            activeInput.innerText = "";
            consoleDiv.appendChild(createPrompt(cmd));

            // Show content
            const rawContent = CONTENTS[contentKey];
            if (rawContent) {
                const outDiv = document.createElement('div');
                outDiv.className = 'output';
                outDiv.innerHTML = rawContent.trim();
                consoleDiv.appendChild(outDiv);
            } else {
                 consoleDiv.appendChild(createLine("Error: File not found or access denied."));
            }

            // Append a new spacer
            consoleDiv.appendChild(document.createElement('br'));
            
            scrollToBottom();
        }

        // --- INIT ---
        window.onload = printBootSequence;

    </script>
</body>
</html>